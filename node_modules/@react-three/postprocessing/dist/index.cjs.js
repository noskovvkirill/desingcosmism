"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("postprocessing"),t=require("@babel/runtime/helpers/objectWithoutPropertiesLoose"),r=require("react"),n=require("three"),o=require("@babel/runtime/helpers/extends"),i=require("@babel/runtime/helpers/construct"),u=require("react-three-fiber");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var f=c(t),a=c(r),l=c(o),s=c(i),d=function(t,n){return void 0===n&&(n=e.BlendFunction.NORMAL),r.forwardRef((function(e,o){var i=e.blendFunction,u=e.opacity,c=f.default(e,["blendFunction","opacity"]),l=r.useMemo((function(){return new t(c)}),[c]);return r.useLayoutEffect((function(){l.blendMode.blendFunction=i||n,void 0!==u&&(l.blendMode.opacity.value=u)}),[i,l.blendMode,u]),a.default.createElement("primitive",{ref:o,object:l,dispose:null})}))},p=function(e,t){var o=e[t];return r.useMemo((function(){if(o instanceof n.Vector2)return(new n.Vector2).set(o.x,o.y);if(Array.isArray(o)){var e=o[0],t=o[1];return(new n.Vector2).set(e,t)}}),[o])},m=function(){try{var e=document.createElement("canvas");return!(!window.WebGL2RenderingContext||!e.getContext("webgl2"))}catch(e){return!1}},v=d(e.BloomEffect,e.BlendFunction.SCREEN),h=d(e.BrightnessContrastEffect),E=r.forwardRef((function(t,n){var o=p(t,"offset"),i=r.useMemo((function(){return new e.ChromaticAberrationEffect(l.default({},t,{offset:o}))}),[o,t]);return a.default.createElement("primitive",{ref:n,object:i,dispose:null})})),x=r.forwardRef((function(t,n){var o=t.blendFunction,i=void 0===o?e.BlendFunction.NORMAL:o,u=r.useMemo((function(){return new e.ColorAverageEffect(i)}),[i]);return a.default.createElement("primitive",{ref:n,object:u,dispose:null})})),g=d(e.ColorDepthEffect),b=d(e.DepthEffect),w=r.createContext(null),S=a.default.memo(r.forwardRef((function(t,o){var i=t.children,c=t.camera,f=t.scene,l=t.renderPriority,d=void 0===l?1:l,p=t.depthBuffer,v=t.stencilBuffer,h=t.multisampling,E=void 0===h?8:h,x=t.frameBufferType,g=void 0===x?n.HalfFloatType:x,b=u.useThree(),S=b.gl,y=b.scene,M=b.camera,R=b.size;f=f||y,c=c||M;var C=r.useMemo((function(){var t=new e.EffectComposer(S,{depthBuffer:p,stencilBuffer:v,multisampling:m()?E:0,frameBufferType:g});t.addPass(new e.RenderPass(f,c));var r=new e.NormalPass(f,c);return t.addPass(r),[t,r]}),[c,S,p,v,E,g,f]),A=C[0],T=C[1];r.useEffect((function(){return null==A?void 0:A.setSize(R.width,R.height)}),[A,R]),u.useFrame((function(e,t){return A.render(t)}),d);var L=r.useRef();r.useEffect((function(){var t;return L.current&&A&&(t=s.default(e.EffectPass,[c].concat(L.current.__objects)),A.addPass(t),t.renderToScreen=!0),function(){t&&(null==A||A.removePass(t))}}),[A,c]);var B=r.useMemo((function(){return{composer:A,normalPass:T,camera:c,scene:f}}),[A,T,c,f]);return r.useImperativeHandle(o,(function(){return A}),[A]),a.default.createElement(w.Provider,{value:B},a.default.createElement("group",{ref:L},i))}))),y=r.forwardRef((function(t,o){var i=t.target,u=t.depthTexture,c=f.default(t,["target","depthTexture"]),l=r.useContext(w).camera,s=r.useMemo((function(){return new e.DepthOfFieldEffect(l,c)}),[l,c]);return r.useLayoutEffect((function(){if(i){var e=i instanceof n.Vector3?(new n.Vector3).set(i.x,i.y,i.z):(new n.Vector3).set(i[0],i[1],i[2]);s.target=e}u&&s.setDepthTexture(u.texture,u.packing)}),[i,u,s]),a.default.createElement("primitive",{ref:o,object:s,dispose:null})})),M=d(e.DotScreenEffect),R=r.forwardRef((function(t,n){var o=t.active,i=f.default(t,["active"]),u=p(i,"delay"),c=p(i,"duration"),s=p(i,"strength"),d=r.useMemo((function(){return new e.GlitchEffect(l.default({},i,{delay:u,duration:c,strength:s}))}),[u,c,i,s]);return r.useLayoutEffect((function(){d.mode=o?i.mode||e.GlitchMode.SPORADIC:e.GlitchMode.DISABLED}),[o,d,i.mode]),a.default.createElement("primitive",{ref:n,object:d,dispose:null})})),C=r.forwardRef((function(t,n){var o=r.useContext(w).camera,i=r.useMemo((function(){return new e.GodRaysEffect(o,t.sun,t)}),[o,t]);return a.default.createElement("primitive",{ref:n,object:i,dispose:null})})),A=r.forwardRef((function(t,n){var o=t.size,i=f.default(t,["size"]),u=r.useMemo((function(){return new e.GridEffect(i)}),[i]);return r.useLayoutEffect((function(){o&&u.setSize(o.width,o.height)}),[u,o]),a.default.createElement("primitive",{ref:n,object:u,dispose:null})})),T=d(e.HueSaturationEffect),L=d(e.NoiseEffect,e.BlendFunction.COLOR_DODGE),B=r.forwardRef((function(t,n){var o=t.selection,i=void 0===o?[]:o,u=t.selectionLayer,c=void 0===u?10:u,l=t.blendFunction,s=t.patternTexture,d=t.edgeStrength,p=t.pulseSpeed,m=t.visibleEdgeColor,v=t.hiddenEdgeColor,h=t.width,E=t.height,x=t.kernelSize,g=t.blur,b=t.xRay,S=(f.default(t,["selection","selectionLayer","blendFunction","patternTexture","edgeStrength","pulseSpeed","visibleEdgeColor","hiddenEdgeColor","width","height","kernelSize","blur","xRay"]),r.useContext(w)),y=S.scene,M=S.camera,R=r.useMemo((function(){return new e.OutlineEffect(y,M,{blendFunction:l,patternTexture:s,edgeStrength:d,pulseSpeed:p,visibleEdgeColor:m,hiddenEdgeColor:v,width:h,height:E,kernelSize:x,blur:g,xRay:b})}),[l,g,M,d,E,v,x,s,p,y,m,h,b]);return r.useEffect((function(){R.clearSelection(),R.setSelection(Array.isArray(i)?i.map((function(e){return e.current})):[i.current])}),[R,i]),r.useEffect((function(){R.selectionLayer=c}),[R,c]),a.default.createElement("primitive",{ref:n,object:R,dispose:null})})),F=r.forwardRef((function(t,n){var o=t.granularity,i=void 0===o?5:o,u=r.useMemo((function(){return new e.PixelationEffect(i)}),[i]);return a.default.createElement("primitive",{ref:n,object:u,dispose:null})})),P=d(e.ScanlineEffect,e.BlendFunction.OVERLAY),j=r.forwardRef((function(t,n){var o=t.selection,i=void 0===o?[]:o,u=t.selectionLayer,c=void 0===u?10:u,f=t.lights,l=void 0===f?[]:f,s=t.luminanceThreshold,d=t.luminanceSmoothing,p=t.intensity,m=t.width,v=t.height,h=t.kernelSize;0===l.length&&console.warn("SelectiveBloom requires lights to work.");var E=r.useContext(w),x=E.scene,g=E.camera,b=r.useMemo((function(){return new e.SelectiveBloomEffect(x,g,{blendFunction:e.BlendFunction.SCREEN,luminanceThreshold:s,luminanceSmoothing:d,intensity:p,width:m,height:v,kernelSize:h})}),[g,v,p,h,d,s,x,m]);return r.useEffect((function(){b.selection.set(Array.isArray(i)?i.map((function(e){return e.current})):[i.current])}),[b,i]),r.useEffect((function(){b.selection.layer=c}),[b,c]),r.useEffect((function(){return l.forEach((function(e){return function(e,t){e.current.layers.enable(t.selection.layer)}(e,b)})),function(){return l.forEach((function(e){return function(e,t){e.current.layers.disable(t.selection.layer)}(e,b)}))}}),[b,l,c]),a.default.createElement("primitive",{ref:n,object:b,dispose:null})})),D=d(e.SepiaEffect),O=r.forwardRef((function(t,n){var o=r.useContext(w),i=o.camera,u=o.normalPass,c=r.useMemo((function(){return new e.SSAOEffect(i,u.renderTarget.texture,l.default({blendFunction:e.BlendFunction.MULTIPLY,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,scale:.5,bias:.5},t))}),[i,u.renderTarget.texture,t]);return a.default.createElement("primitive",{ref:n,object:c,dispose:null})})),G=r.forwardRef((function(t,n){var o=t.preset,i=void 0===o?e.SMAAPreset.HIGH:o,c=t.edgeDetectionMode,f=void 0===c?e.EdgeDetectionMode.COLOR:c,l=u.useLoader(e.SMAAImageLoader,""),d=r.useMemo((function(){return s.default(e.SMAAEffect,l.concat([i,f]))}),[l,i,f]);return a.default.createElement("primitive",{ref:n,object:d,dispose:null})})),z=r.forwardRef((function(t,o){var i=t.textureSrc,c=t.texture,s=f.default(t,["textureSrc","texture"]),d=u.useLoader(n.TextureLoader,i);r.useLayoutEffect((function(){d.encoding=n.sRGBEncoding,d.wrapS=d.wrapT=n.RepeatWrapping}),[d]);var p=r.useMemo((function(){return new e.TextureEffect(l.default({},s,{texture:d||c}))}),[s,d,c]);return a.default.createElement("primitive",{ref:o,object:p,dispose:null})})),V=d(e.ToneMappingEffect),q=d(e.VignetteEffect);exports.Bloom=v,exports.BrightnessContrast=h,exports.ChromaticAberration=E,exports.ColorAverage=x,exports.ColorDepth=g,exports.Depth=b,exports.DepthOfField=y,exports.DotScreen=M,exports.EffectComposer=S,exports.EffectComposerContext=w,exports.Glitch=R,exports.GodRays=C,exports.Grid=A,exports.HueSaturation=T,exports.Noise=L,exports.Outline=B,exports.Pixelation=F,exports.SMAA=G,exports.SSAO=O,exports.Scanline=P,exports.SelectiveBloom=j,exports.Sepia=D,exports.Texture=z,exports.ToneMapping=V,exports.Vignette=q;
